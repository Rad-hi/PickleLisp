(dll "raylib" "./thirdparty/raylib-5.5_linux_amd64/lib/libraylib.so")

( mktype "Color" {Char Char Char Char} )
( mktype "Vector2" {Float Float} )

( extern raylib "InitWindow" {Int Int String} {Void} )
( extern raylib "WindowShouldClose" {Void} {Int} )
( extern raylib "BeginDrawing" {Void} {Void} )
( extern raylib "EndDrawing" {Void} {Void} )
( extern raylib "CloseWindow" {Void} {Void} )
( extern raylib "SetTargetFPS" {Int} {Void} )
( extern raylib "ClearBackground" {Color} {Void} )
( extern raylib "GetTouchPosition" {Int} {Vector2} )
( extern raylib "DrawPixel" {Int Int Color} {Void} )
( extern raylib "DrawLine" {Int Int Int Int Color} {Void} );
( extern raylib "IsKeyPressed" {Int} {Int} )
( extern raylib "DrawText" {String Int Int Int Color} {Void} )

( def {KEY_P} 80 )
( def {KEY_R} 82 )

( def {ZOZINGRAY}   (list 22 22 22 255) )
( def {ZOZINLIGHT}  (list 55 55 55 255) )
( def {PICKLEGREEN} (list 133 161 106 255) )

( def {FPS} 30 )
( def {title} "PcikleLisp RayLib Example - touch" )
( def {win_width} 960 )
( def {win_height} 480 )

( def {prev_pos} ( list 0 0 ) )
( def {pixel_mode} 0 )

( fn { draw_msg _ } {
    ( = {font_sz} 28 )
    ( = {msg} "Move your cursor inside the window!" )
    ( = {msg_len} ( len msg ) )
    ( = {viz_msg_len} (* (- msg_len 1) (/ font_sz 2)) )

    ( = {x} (/ (- win_width viz_msg_len ) 2) )
    ( = {y} (/ (- win_height font_sz) 2) )
    ( DrawText msg x y font_sz ZOZINLIGHT )
    ( DrawText "Press [p] to change the drawing mode!" (+ x 20) (+ y 40) 23 ZOZINLIGHT )
    ( DrawText "Press [r] to clear the screen!" (+ x 50) (+ y 80) 23 ZOZINLIGHT )
})

( fn { loop func } {

    if ( == ( func {} ) 1 )
    { nil }
    {
        ( BeginDrawing {} )

            (
                if ( == (IsKeyPressed KEY_R) 1)
                {
                    ( ClearBackground ZOZINGRAY )
                    ( draw_msg {} )
                }
                { nil }
            )

            (
                if ( == (IsKeyPressed KEY_P) 1)
                {(
                    if ( == pixel_mode 1 )
                    { ( def {pixel_mode} 0 ) }
                    { ( def {pixel_mode} 1 ) } 
                )}
                { nil }
            )

            ( def {cur_pos} ( GetTouchPosition 0 ))
            ( def {cur_x} ( cast ( st cur_pos ) Int ) )
            ( def {cur_y} ( cast ( nd cur_pos ) Int ) )

            (
                if ( == pixel_mode 1 )
                { ( DrawPixel cur_x cur_y PICKLEGREEN ) }
                {
                    ( def {prev_x} ( cast ( st prev_pos ) Int ) )
                    ( def {prev_y} ( cast ( nd prev_pos ) Int ) )
                    ( DrawLine prev_x prev_y cur_x cur_y PICKLEGREEN )
                }
            )

            ( def {prev_pos} ( list cur_x cur_y ) )

        ( EndDrawing {} )
        ( loop func )
    }
})


( InitWindow win_width win_height title )
( ClearBackground ZOZINGRAY )
( SetTargetFPS FPS )
( draw_msg {} )
( loop WindowShouldClose)
( CloseWindow {} )
